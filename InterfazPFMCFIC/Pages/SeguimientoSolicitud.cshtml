@page
@using InterfazPFMCFIC.Models
@model SeguimientoSolicitudModel
@{
    ViewData["OcultarMenu"] = true;
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<h6 class="text-center mb-3" style="font-weight:500; font-size:1.1rem;">Seguimiento de Solicitud</h6>

@if (Model.Movimientos.Any())
{
    <div class="d-flex justify-content-center">
        <table class="table table-striped table-sm" style="max-width:450px; font-size:0.93rem;">
            <thead>
                <tr>
                    <th class="text-center" style="padding:0.1rem 0.3rem; font-size:0.95rem;">Tipo</th>
                    <th class="text-center" style="padding:0.1rem 0.3rem; font-size:0.95rem;">Fecha</th>
                    <th class="text-center" style="padding:0.1rem 0.3rem; font-size:0.95rem;">Folio</th>
                    <th class="text-center" style="padding:0.1rem 0.3rem; font-size:0.95rem;">Archivo</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.Movimientos.Count; i++)
                {
                    var mov = Model.Movimientos[i];
                    var urlDescarga = Url.Page("/DescargarArchivo", null, new { archivoId = mov.ArchivoId, token = Model.CurrentToken }, Request.Scheme);
                    <tr>
                        <td class="text-center" style="padding:0.3rem 0.5rem;">
                            @if (mov.Tipo == TipoConfirmacion.Rechazado)
                            {
                                <a data-bs-toggle="collapse"
                                   href="#rechazoDetalle_@i"
                                   role="button"
                                   aria-expanded="false"
                                   aria-controls="rechazoDetalle_@i"
                                   style="color: #dc3545; text-decoration:underline; cursor:pointer;">
                                    @mov.Tipo
                                </a>
                            }
                            else
                            {
                                @mov.Tipo
                            }
                        </td>
                        <td class="text-center" style="padding:0.3rem 0.5rem;">@mov.Fecha?.ToString("dd/MM/yyyy")</td>
                        <td class="text-center" style="padding:0.3rem 0.5rem;">@mov.Folio</td>
                        <td class="text-center" style="padding:0.3rem 0.5rem;">
                            @if (mov.ArchivoId > 0 && !string.IsNullOrEmpty(mov.ArchivoNombre))
                            {
                                <a href="@urlDescarga"
                                   target="_blank"
                                   title="Descargar PDF"
                                   style="text-decoration:none;">
                                    <img src="https://localhost:7292/img/file-pdf-solid.svg" alt="PDF"
                                         style="width:1em; height:1em; vertical-align:middle; filter: invert(18%) sepia(97%) saturate(7492%) hue-rotate(353deg) brightness(91%) contrast(101%);" />
                                </a>
                            }
                            else
                            {
                                <span>
                                    <img src="https://localhost:7292/img/file-broken-svg.svg"
                                         style="width:1em; height:1em; vertical-align:middle; filter: grayscale(1) brightness(1.6) contrast(0.7);" />
                                </span>
                            }
                        </td>
                    </tr>
                    @if (mov.Tipo == TipoConfirmacion.Rechazado)
                    {
                        <tr class="collapse bg-light" id="rechazoDetalle_@i">
                            <td colspan="4">
                                <div class="p-3">
                                    <strong>Tipo de Rechazo:</strong> @mov.TipoRechazoId <br />
                                    <strong>Motivo de Rechazo:</strong>
                                    @Model.MotivosRechazo.FirstOrDefault(m => m.MotivoRechazoId == mov.MotivoRechazoId)?.Motivo
                                    <br />
                                    <strong>Observaciones:</strong> @mov.ObservacionesRechazo
                                    <br />
                                </div>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
    @if (Model.TotalPaginas > 1)
    {
        <nav>
            <ul class="pagination justify-content-center">
                <li class="page-item @(Model.Pagina == 1 ? "disabled" : "")">
                    <a class="page-link" href="/SeguimientoSolicitud?ActoID=@Model.ActoID&Pagina=@(Model.Pagina - 1)">Anterior</a>
                </li>
                @for (int i = 1; i <= Model.TotalPaginas; i++)
                {
                    <li class="page-item @(i == Model.Pagina ? "active" : "")">
                        <a class="page-link" href="/SeguimientoSolicitud?ActoID=@Model.ActoID&Pagina=@i">@i</a>
                    </li>
                }
                <li class="page-item @(Model.Pagina == Model.TotalPaginas ? "disabled" : "")">
                    <a class="page-link" href="/SeguimientoSolicitud?ActoID=@Model.ActoID&Pagina=@(Model.Pagina + 1)">Siguiente</a>
                </li>
            </ul>
        </nav>
    }
}
else
{
    <p class="text-center">No hay movimientos para este ActoID.</p>
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />